<?xml version="1.0" encoding="utf-8" ?>
<!-- Copyright 2017 Sergio Teruel <sergio.teruel@tecnativa.com>
     License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl). -->
<odoo>

<act_window
        id="wiz_price_history_action"
        name="History Price"
        binding_model="sale.order.line"
        res_model="wizard.sale.line.history.price"
        view_mode="form"
        target="new"
        binding_views="form"
    />

<record id="wiz_history_price_form" model="ir.ui.view">
    <field name="name">wizard.sale.line.history.price.form</field>
    <field name="model">wizard.sale.line.history.price</field>
    <field name="arch" type="xml">
        <form string="History Price From Sale Order Lines">
            <field name="sale_line_id" invisible="1" />
            <group name="filter_fields" col="4">
                <field name="partner_id" />
                <field name="product_id" />
            </group>
            <group string="History Prices">
                <field name="sale_line_ids" nolabel="1">
                    <tree>
                        <field name="order_partner_id" readonly="1" />
                        <field name="product_id" readonly="1" />
                        <field name="name" readonly="1" />
                        <field name="price_unit" readonly="1" />
                        <field name="price_history" />
                        <button
                                name="set_price"
                                type="object"
                                icon="fa-check text-success"
                                context="{'to_set_price_line_id': parent.sale_line_id}"
                            />
                    </tree>
                </field>
            </group>
            <footer>
                <button special="cancel" string="Cancel" />
            </footer>
        </form>
    </field>
</record>

<record id="wiz_view_order_form" model="ir.ui.view">
    <field name="model">sale.order</field>
    <field name="inherit_id" ref="sale.view_order_form" />
    <field name="arch" type="xml">
        <xpath
                expr="//field[@name='order_line']/tree/field[@name='price_unit']"
                position="after"
            >
                <button
                    name="%(sale_price_from_history.wiz_price_history_action)d"
                    type="action"
                    icon="fa-money"
                    class="oe_inline oe_link oe_edit_only"
                />
        </xpath>
    </field>
</record>

</odoo>
